<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Toolbox Commons - Tutorials</title>
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Toolbox Commons</h1>
          <h2>A set of common utilities for program analysis using Atlas</h2>
          <br />
          <center>
            <b><a href="./index.html">Home</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="./install.html">Install</a>&nbsp;&nbsp;&nbsp;&nbsp;Tutorials</b>
          </center>
        </header>
        <center>
            <b><a href="#Setup">Setup</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#RunningExamples">Running Examples</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Examples">Examples</a></b>
        </center>
        
        <hr>

        <section id="main_content">

        <h3><a name="Setup" class="anchor" href="#Setup"><span class="octicon octicon-link"></span></a>Setup</h3>
        <p>If you haven't already, <a href="./install.html">install</a> the Toolbox Commons plugin into Eclipse.</p>
        
        <h3><a name="RunningExamples" class="anchor" href="#RunningExamples"><span class="octicon octicon-link"></span></a>Running Examples</h3>
        <p>The easiest way to try out the Toolbox Commons is to fork or clone the <a href="https://github.com/EnSoftCorp/Starter-Toolbox">Starter-Toolbox</a> project, which already has a dependency on the Toolbox-Commons configured.</p>
        <pre><code>git clone git@github.com:EnSoftCorp/Starter-Toolbox.git</code></pre>
        <p>Import the <code>toolbox.analysis</code> and <code>toolbox.shell</code> projects into the workspace.  Navigate to <code>Window</code>&gt;<code>Show View</code>&gt;<code>Other...</code>&gt;<code>Atlas</code>&gt;<code>Atlas Shell</code>.  Select the <code>toolbox.shell</code> project and press <code>OK</code>.  You should also import and index an Eclipse project for analysis.</p>
        <p>To run the examples below, copy and paste the code snippets into your toolbox project and invoke from the Atlas Shell.</p>
        
        <h3><a name="Examples" class="anchor" href="#Examples"><span class="octicon octicon-link"></span></a>Examples</h3>
        <p>The Toolbox-Commons project contains several program analysis utilities that may or may not be applicable to your specific analysis needs.  The table of contents below categorizes the examples by general analysis needs.  You should jump to the examples that interest you.</p>
        
        <h4>1. <a href="#WritingAProgramAnalyzer">Writing a Program Analyzer</a><h4>
        <h5>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;<a href="#ExtendingTheAnalyzerFramework">Extending the Analyzer Framework</a></h5>
        <h4>2. <a href="#FormattedSourceCorrespondence">Formatted SourceCorrespondence</a></h4>
        <h5>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;<a href="#PrettyPrintingQAndGraphElementSourceLocations">Pretty Printing Q and GraphElement Source Locations</a><h5>
        <h4>3. <a href="#DisplayUtils">Display Utils</a><h4>
        <h5>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;<a href="#ShowingDisplayDialogs">Showing Display Dialogs</a></h5>
        <h5>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;<a href="#ShowingAndSavingAtlasGraphs">Showing and Saving Atlas Graphs</a></h5>
        
        <hr>
        
        <h3><a name="WritingAProgramAnalyzer" class="anchor" href="#WritingAProgramAnalyzer"><span class="octicon octicon-link"></span></a>1. Writing a Program Analyzer</h3>
        <p>A program Analyzer is a modularized analysis program to analyze a certain aspect of the program graph.  The result of an analysis is an "envelope", which is a <code>Q</code> object containing the necessary elements from the program graph to convey the result of the analysis.  Typically an envelope is empty if the analysis property is not satisfied (undetected in the program graph), and not empty if the analysis property is satisfied (detected in the program graph).</p>
        <h4><a name="ExtendingTheAnalyzerFramework" class="anchor" href="#ExtendingTheAnalyzerFramework"><span class="octicon octicon-link"></span></a>Extending the Analyzer Framework</h4>
        <p>To create a new <code>Analyzer</code> simply extend the <code>com.ensoftcorp.open.toolbox.commons.analysis.Analyzer</code> class and implement the required methods.  An example <code>Analyzer</code> to detect valid Java main methods is provided in the <code>Starter-Toolbox</code> called <code>DiscoverMainMethods</code>.</p>
		<p>Running our <code>Analyzer</code> is simple, just construct a new <code>DiscoverMainMethods</code> <code>Analyzer</code> object and call the <code>getEnvelope</code> method.  The first time you call <code>getEnvelope</code>, the result is cached in the object so calling <code>getEnvelope()</code> again is cheap.  Note that the <code>DiscoverMainMethods</code> <code>Analyzer</code> above is designed to return an empty <code>Q</code> object if no valid Java main methods are discovered.</p>
        <pre><code>Analyzer analyzer = new DiscoverMainMethods(); // lazily instantiate Analyzer
Q envelope = analyzer.getEnvelope(); // performs analysis
if(envelope.eval().nodes().size() == 0){
    DisplayUtils.showMessage("No valid Java main methods detected!");
} else {
    // valid main methods found, show the Atlas graph with the results!
    Highlighter h = null; // no highlighting
    boolean extend = true; // perform a reverse DECLARES walk to show the node context
    DisplayUtils.show(envelope, h, extend, "Detected valid Java main methods");
}</code></pre>
		
        <h3><a name="FormattedSourceCorrespondence" class="anchor" href="#FormattedSourceCorrespondence"><span class="octicon octicon-link"></span></a>2. Formatted SourceCorrespondence</h3>
        <p>Atlas conveniently provides <code>SourceCorrespondence</code> objects for <code>GraphElement</code> objects in the program graph, but the corresponding source file information is represented in terms of Eclipse resources and character offsets.  For non-interactive human readable output this isn't enough.  This utility converts Eclipse resources to standard File objects and relative file path strings, as well as converting resource character offsets to a line number or range of line numbers.</p>
        <h4><a name="PrettyPrintingQAndGraphElementSourceLocations" class="anchor" href="#PrettyPrintingQAndGraphElementSourceLocations"><span class="octicon octicon-link"></span></a>Pretty Printing Q and GraphElement Source Locations</h4>
        <pre><code>Analyzer analyzer = new DiscoverMainMethods(); // lazily instantiate Analyzer
Q envelope = analyzer.getEnvelope(); // performs analysis
FileWriter fw = new FileWriter(new File("output.txt"));
if(envelope.eval().nodes().size() == 0){
    fw.write("No valid Java main methods detected!");
} else {
    // valid main methods found, write the source file names 
    // and line numbers of the results to the output file
    FormattedSourceCorrespondence fsc = FormattedSourceCorrespondence.getSourceCorrespondents(envelope);
    fw.write(fsc.toString());
}
fw.close();</code></pre>
		<p>Assuming the project you analyzed had one or more valid Java main methods, the output.txt file would contain something similar to the following.</p>
		<pre><code>[Filename: ExampleProject\src\com\example\ExampleClass.java (line 5)]</code></pre>
		<p>A <code>Q</code> with multiple file and line number correspondents might look similar to the following.</p>
		<pre><code>[Filename: ExampleProject\src\com\example\ExampleClass.java (lines 5-12, 15),
 Filename: ExampleProject\src\com\example\AnotherExampleClass.java (line 3)]</code></pre>
		<p>To get a <code>FormattedSourceCorrespondence</code> for a single <code>GraphElement</code> use the <code>FormattedSourceCorrespondence.getSourceCorrespondent(GraphElement ge)</code> method.</p>
        
        <h3><a name="DisplayUtils" class="anchor" href="#DisplayUtils"><span class="octicon octicon-link"></span></a>3. Display Utils</h3>
        <p>TODO</p>
        <h4><a name="ShowingDisplayDialogs" class="anchor" href="#ShowingDisplayDialogs"><span class="octicon octicon-link"></span></a>Showing Display Dialogs</h4>
        <p>TODO</p>
        <h4><a name="ShowingAndSavingAtlasGraphs" class="anchor" href="#ShowingAndSavingAtlasGraphs"><span class="octicon octicon-link"></span></a>Showing and Saving Atlas Graphs</h4>
        <p>TODO</p>
        
        <footer>
          Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

      </div>
    </div>
  </body>
</html>